<mxfile host="Electron" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/29.0.3 Chrome/140.0.7339.249 Electron/38.7.0 Safari/537.36" version="29.0.3" pages="3">
  <diagram name="Component" id="JEG9QD1Mrv43UL4B3qsw">
    <mxGraphModel dx="1455" dy="2618" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-5" value="System" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontSize=24;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="347" y="-1114" width="906" height="224" as="geometry" />
        </mxCell>
        <mxCell id="5txUxx_X9ObpxMV71YgC-1" value="Postgres&lt;br&gt;&lt;br&gt;(events, checkpoints, rules, labels, subscriptions, alert_log)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="595" y="-1072" width="344" height="107" as="geometry" />
        </mxCell>
        <mxCell id="5txUxx_X9ObpxMV71YgC-2" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;Telemetry (Prometheus scrape)&lt;/span&gt;&lt;/div&gt;" style="shape=label;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="662.5" y="-1203" width="175" height="62" as="geometry" />
        </mxCell>
        <mxCell id="5txUxx_X9ObpxMV71YgC-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="5txUxx_X9ObpxMV71YgC-3" target="5txUxx_X9ObpxMV71YgC-1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="950" y="-1031" />
              <mxPoint x="950" y="-1031" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="5txUxx_X9ObpxMV71YgC-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="5txUxx_X9ObpxMV71YgC-3" target="5txUxx_X9ObpxMV71YgC-8">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="858" y="-931" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-28" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="5txUxx_X9ObpxMV71YgC-3" target="5txUxx_X9ObpxMV71YgC-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-254" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="5txUxx_X9ObpxMV71YgC-3" target="-gmcYHsltVzMwtbIWMZ_-253">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="5txUxx_X9ObpxMV71YgC-3" value="TonWorker (.Net)&lt;br&gt;&lt;br&gt;Ingestor → Normalizer → Persistor → RuleEngine → Notifier&lt;br&gt;&lt;br&gt;(read rules)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1021" y="-1084" width="208" height="125" as="geometry" />
        </mxCell>
        <mxCell id="5txUxx_X9ObpxMV71YgC-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="5txUxx_X9ObpxMV71YgC-5" target="5txUxx_X9ObpxMV71YgC-1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="539" y="-1026" />
              <mxPoint x="539" y="-1026" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="5txUxx_X9ObpxMV71YgC-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="5txUxx_X9ObpxMV71YgC-5" target="5txUxx_X9ObpxMV71YgC-2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="439" y="-1173" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="5txUxx_X9ObpxMV71YgC-5" value="API (.Net)&lt;br&gt;&lt;br&gt;(admin/read-only: rules/labels/subscriptions, query events)&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;(write rules)&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="366" y="-1074" width="146" height="151" as="geometry" />
        </mxCell>
        <mxCell id="5txUxx_X9ObpxMV71YgC-8" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;TON Provider&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="1070.5" y="-860" width="109" height="66" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-1" value="Component" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=54;" vertex="1" parent="1">
          <mxGeometry x="205" y="-1355" width="198" height="56" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-2" value="Activity" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=54;" vertex="1" parent="1">
          <mxGeometry x="178" y="905" width="149" height="56" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-6" value="Use case: Ingest whales" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=30;" vertex="1" parent="1">
          <mxGeometry x="181" y="1170" width="352" height="54" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-7" value="Future" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontSize=54;" vertex="1" parent="1">
          <mxGeometry x="195" y="4575" width="179" height="56" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-8" value="&lt;div&gt;Use case: ingestion via streaming&lt;/div&gt;Use case: Non-TON transactions&lt;div&gt;Frontend&lt;/div&gt;" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="215.25" y="4647" width="364" height="106" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" target="-gmcYHsltVzMwtbIWMZ_-15">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="526" y="832.5" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-22" value="Use case: Create alerts" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=left;verticalAlign=top;rounded=0;fontSize=30;" vertex="1" parent="1">
          <mxGeometry x="198" y="2962" width="340" height="61" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-46" value="Dedup key: event_id = hash(chain + address + lt + tx_hash)" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontStyle=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1348" y="-932" width="284" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-47" value="Checkpoint cursor: last_lt + last_hash" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontStyle=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1348" y="-907" width="184" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-48" value="Idempotent insert: ON CONFLICT DO NOTHING" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontStyle=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1348" y="-882" width="227" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-49" value="Failure mode: crash mid-run → restart safe" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontStyle=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1348" y="-855" width="209.5" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-50" value="Polling + streaming: streaming later + polling backfill always" style="text;html=1;whiteSpace=wrap;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;rounded=0;fontStyle=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1348" y="-830" width="290" height="30" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-77" value="Backfill Worker" style="whiteSpace=wrap;strokeWidth=2;fontSize=30;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="2356" y="1145" width="881" height="148" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-78" value="Postgres" style="whiteSpace=wrap;strokeWidth=2;fontSize=30;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="6404" y="2220" width="622" height="425" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-79" value="Checkpoint Updater" style="whiteSpace=wrap;strokeWidth=2;fontSize=30;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="5859" y="1588" width="964" height="217" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-80" value="Persistence Service" style="whiteSpace=wrap;strokeWidth=2;verticalAlign=top;fontSize=30;" vertex="1" parent="1">
          <mxGeometry x="4103" y="2002" width="1429" height="414" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-81" value="Normalizer Service" style="whiteSpace=wrap;strokeWidth=2;fontSize=30;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="2356" y="1313" width="1422" height="183" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-82" value="Event Bus / Topics" style="whiteSpace=wrap;strokeWidth=2;fontSize=30;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="2105" y="1516" width="3701" height="466" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-83" value="TON Provider (3rd party)" style="whiteSpace=wrap;strokeWidth=2;verticalAlign=top;fontSize=30;" vertex="1" parent="1">
          <mxGeometry x="1376" y="1213" width="366" height="187" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-84" value="Ingestor Service" style="whiteSpace=wrap;strokeWidth=2;fontSize=30;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="558" y="1420" width="1497" height="1226" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-85" value="Trigger / Scheduler" style="whiteSpace=wrap;strokeWidth=2;fontSize=30;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="198" y="1902" width="310" height="144" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-86" value="Tick / Schedule Fired" style="strokeWidth=2;shape=process;whiteSpace=wrap;size=0.04;" vertex="1" parent="1">
          <mxGeometry x="258" y="1971.5" width="184" height="39" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-87" value="Acquire address lease&#xa;(chain+address)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="583" y="1952" width="215" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-88" value="Load checkpoint cursor&#xa;(last_lt + last_hash)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="848" y="1856" width="226" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-89" value="Fetch batch from TON Provider&#xa;(limit, cursor)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1125" y="1557" width="260" height="102" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-90" value="Gap detected?&#xa;(startup/outage)" style="rhombus;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="1460" y="1627" width="198" height="198" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-91" value="Publish BatchFetched&#xa;(batch_id, cursor_range)" style="strokeWidth=2;shape=process;whiteSpace=wrap;size=0.04;" vertex="1" parent="1">
          <mxGeometry x="1821" y="1828" width="208" height="63" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-92" value="Publish GapDetected&#xa;(address, from_cursor)" style="strokeWidth=2;shape=process;whiteSpace=wrap;size=0.04;" vertex="1" parent="1">
          <mxGeometry x="1828" y="1604" width="194" height="63" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-93" value="Transactions API" style="shape=cylinder3;boundedLbl=1;backgroundOutline=1;size=10;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="1494" y="1288" width="130" height="77" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-94" value="topic: batch_fetched" style="ellipse;shape=doubleEllipse;aspect=fixed;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="2130" y="1771" width="176" height="176" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-95" value="topic: raw_tx_received" style="ellipse;shape=doubleEllipse;aspect=fixed;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="3246" y="1653" width="191" height="191" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-96" value="topic: canonical_event_ready" style="ellipse;shape=doubleEllipse;aspect=fixed;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="3828" y="1636" width="225" height="225" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-97" value="topic: batch_committed" style="ellipse;shape=doubleEllipse;aspect=fixed;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="5581" y="1628" width="199" height="199" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-98" value="topic: gap_detected" style="ellipse;shape=doubleEllipse;aspect=fixed;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="2132" y="1551" width="170" height="170" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-99" value="Consume BatchFetched" style="strokeWidth=2;shape=process;whiteSpace=wrap;size=0.04;" vertex="1" parent="1">
          <mxGeometry x="2381" y="1394" width="198" height="39" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-100" value="Fetch/expand tx details if needed" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="2629" y="1375" width="260" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-101" value="Normalize raw tx -&gt; CanonicalEvent" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="3212" y="1365" width="260" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-102" value="Publish RawTxReceived&#xa;(tx_id, batch_id)" style="strokeWidth=2;shape=process;whiteSpace=wrap;size=0.04;" vertex="1" parent="1">
          <mxGeometry x="2964" y="1382" width="198" height="63" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-103" value="Publish CanonicalEventReady&#xa;(event_id, batch_id, cursor)" style="strokeWidth=2;shape=process;whiteSpace=wrap;size=0.04;" vertex="1" parent="1">
          <mxGeometry x="3522" y="1348" width="231" height="111" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-104" value="Consume CanonicalEventReady" style="strokeWidth=2;shape=process;whiteSpace=wrap;size=0.04;" vertex="1" parent="1">
          <mxGeometry x="4128" y="2154" width="231" height="63" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-105" value="Upsert event into Postgres&#xa;UNIQUE(event_id) =&amp;gt; idempotent" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="4409" y="2189" width="260" height="102" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-106" value="Track per-batch progress&#xa;(highest cursor committed)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="4736" y="2174" width="255" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-107" value="Batch complete?" style="rhombus;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="5041" y="2037" width="172" height="172" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-108" value="Publish BatchCommitted&#xa;(batch_id, highest_cursor)" style="strokeWidth=2;shape=process;whiteSpace=wrap;size=0.04;" vertex="1" parent="1">
          <mxGeometry x="5287" y="2092" width="220" height="63" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-109" value="Consume BatchCommitted" style="strokeWidth=2;shape=process;whiteSpace=wrap;size=0.04;" vertex="1" parent="1">
          <mxGeometry x="5880" y="1708" width="220" height="39" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-110" value="Advance checkpoint&#xa;ONLY after commit" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="6150" y="1689" width="203" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-111" value="Release address lease" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="6579" y="1701" width="215" height="54" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-112" value="events" style="shape=cylinder3;boundedLbl=1;backgroundOutline=1;size=10;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="6448" y="2255" width="62" height="64" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-113" value="checkpoints" style="shape=cylinder3;boundedLbl=1;backgroundOutline=1;size=10;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="6429" y="2369" width="100" height="72" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-114" value="ingestion_leases" style="shape=cylinder3;boundedLbl=1;backgroundOutline=1;size=10;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="6869" y="2533" width="132" height="77" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-115" value="batch_state" style="shape=cylinder3;boundedLbl=1;backgroundOutline=1;size=10;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="6429" y="2492" width="100" height="72" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-116" value="Consume GapDetected" style="strokeWidth=2;shape=process;whiteSpace=wrap;size=0.04;" vertex="1" parent="1">
          <mxGeometry x="2383" y="1200" width="194" height="39" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-117" value="Request backfill polls&#xa;until caught up" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="2999" y="1180" width="213" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-118" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.51;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-86" target="-gmcYHsltVzMwtbIWMZ_-87">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-119" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.75;exitY=0.01;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-87" target="-gmcYHsltVzMwtbIWMZ_-88">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="823" y="1895" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-120" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.59;exitY=0;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-88" target="-gmcYHsltVzMwtbIWMZ_-89">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1100" y="1608" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-121" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.72;exitY=0;entryX=0.25;entryY=1;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-89" target="-gmcYHsltVzMwtbIWMZ_-93">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1410" y="1473" />
              <mxPoint x="1435" y="1473" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-122" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.76;exitY=1;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-89" target="-gmcYHsltVzMwtbIWMZ_-90">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1410" y="1726" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-123" value="yes" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.14;entryX=0;entryY=0.51;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-90" target="-gmcYHsltVzMwtbIWMZ_-92">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1683" y="1636" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-124" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.51;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-92" target="-gmcYHsltVzMwtbIWMZ_-98">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-125" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0.47;entryY=0.99;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-98" target="-gmcYHsltVzMwtbIWMZ_-116">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2356" y="1636" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-126" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.49;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-116" target="-gmcYHsltVzMwtbIWMZ_-117">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-127" value="no/continue" style="curved=1;startArrow=none;endArrow=block;exitX=0.97;exitY=1;entryX=0;entryY=0.49;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-90" target="-gmcYHsltVzMwtbIWMZ_-91">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1683" y="1859" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-128" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.49;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-91" target="-gmcYHsltVzMwtbIWMZ_-94">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-129" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0.47;entryY=1;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-94" target="-gmcYHsltVzMwtbIWMZ_-99">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2356" y="1859" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-130" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.49;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-99" target="-gmcYHsltVzMwtbIWMZ_-100">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-131" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.49;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-100" target="-gmcYHsltVzMwtbIWMZ_-102">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-132" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.95;entryX=0.24;entryY=0;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-102" target="-gmcYHsltVzMwtbIWMZ_-95">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3187" y="1449" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-133" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.37;entryX=0;entryY=0.49;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-102" target="-gmcYHsltVzMwtbIWMZ_-101">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3187" y="1404" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-134" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.49;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-101" target="-gmcYHsltVzMwtbIWMZ_-103">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-135" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-103" target="-gmcYHsltVzMwtbIWMZ_-96">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3778" y="1404" />
              <mxPoint x="3803" y="1749" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-136" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0.45;entryY=0.01;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-96" target="-gmcYHsltVzMwtbIWMZ_-104">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4103" y="1749" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-137" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.85;exitY=1.01;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-104" target="-gmcYHsltVzMwtbIWMZ_-105">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4384" y="2240" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-138" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.87;entryX=-0.01;entryY=0.51;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-105" target="-gmcYHsltVzMwtbIWMZ_-112">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4702" y="2287" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-139" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.29;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-105" target="-gmcYHsltVzMwtbIWMZ_-106">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4702" y="2213" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-140" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.67;exitY=0;entryX=0;entryY=0.27;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-106" target="-gmcYHsltVzMwtbIWMZ_-107">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="5016" y="2073" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-141" value="no" style="curved=1;startArrow=none;endArrow=block;exitX=0;exitY=0.55;entryX=0.86;entryY=0.01;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-107" target="-gmcYHsltVzMwtbIWMZ_-104">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="5016" y="2133" />
              <mxPoint x="4384" y="2133" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-142" value="yes" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-107" target="-gmcYHsltVzMwtbIWMZ_-108">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-143" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-108" target="-gmcYHsltVzMwtbIWMZ_-97">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="5531" y="2123" />
              <mxPoint x="5556" y="1728" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-144" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-97" target="-gmcYHsltVzMwtbIWMZ_-109">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-145" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.49;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-109" target="-gmcYHsltVzMwtbIWMZ_-110">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-146" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.49;entryX=0.46;entryY=0;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-110" target="-gmcYHsltVzMwtbIWMZ_-113">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="6404" y="1728" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-147" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.51;entryX=0.47;entryY=0.99;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-113" target="-gmcYHsltVzMwtbIWMZ_-111">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="6554" y="2405" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-148" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.49;entryX=0.35;entryY=0;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-111" target="-gmcYHsltVzMwtbIWMZ_-114">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="6819" y="1728" />
              <mxPoint x="6844" y="2393" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-149" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.54;exitY=1.01;entryX=0;entryY=0.76;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-87" target="-gmcYHsltVzMwtbIWMZ_-114">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="823" y="2599" />
              <mxPoint x="6844" y="2599" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-150" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.63;exitY=1;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-106" target="-gmcYHsltVzMwtbIWMZ_-115">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="5016" y="2396" />
              <mxPoint x="5531" y="2396" />
              <mxPoint x="5556" y="2528" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-151" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.54;exitY=1;entryX=0;entryY=0.51;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-88" target="-gmcYHsltVzMwtbIWMZ_-113">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1100" y="2465" />
              <mxPoint x="5531" y="2465" />
              <mxPoint x="5556" y="2405" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-153" value="Postgres" style="whiteSpace=wrap;strokeWidth=2;fontSize=30;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="1096" y="3036" width="4522" height="291" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-154" value="Persistence Service (Delivery result)" style="whiteSpace=wrap;strokeWidth=2;fontSize=30;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="7417" y="3033" width="1183" height="1061" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-155" value="Notifier" style="whiteSpace=wrap;strokeWidth=2;fontSize=30;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="5973" y="3322" width="1106" height="307" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-156" value="Outbox Dispatcher" style="whiteSpace=wrap;strokeWidth=2;fontSize=30;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="4885" y="3392" width="1038" height="181" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-157" value="Persistence Service (Alert State + Outbox boundary)" style="whiteSpace=wrap;strokeWidth=2;fontSize=30;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="2599" y="3348" width="1987" height="269" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-158" value="Rule Engine" style="whiteSpace=wrap;strokeWidth=2;fontSize=30;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="544" y="3392" width="1733" height="181" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-159" value="Event Bus / Topics (can be in-proc in MVP)" style="whiteSpace=wrap;strokeWidth=2;fontSize=30;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="244" y="3649" width="7123" height="512" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-160" value="topic: canonical_event_ready" style="ellipse;shape=doubleEllipse;aspect=fixed;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="269" y="3793" width="225" height="225" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-161" value="topic: alert_intent_created" style="ellipse;shape=doubleEllipse;aspect=fixed;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="2327" y="3795" width="222" height="222" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-162" value="topic: outbox_enqueued" style="ellipse;shape=doubleEllipse;aspect=fixed;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="4635" y="3806" width="200" height="200" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-163" value="topic: delivery_succeeded" style="ellipse;shape=doubleEllipse;aspect=fixed;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="7129" y="3914" width="213" height="213" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-164" value="topic: delivery_failed" style="ellipse;shape=doubleEllipse;aspect=fixed;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="7146" y="3684" width="179" height="179" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-165" value="Consume CanonicalEventReady" style="strokeWidth=2;shape=process;whiteSpace=wrap;size=0.04;" vertex="1" parent="1">
          <mxGeometry x="569" y="3451" width="231" height="63" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-166" value="Load enabled rules&#xa;(from DB/cache)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="850" y="3443" width="196" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-167" value="Evaluate rules" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1221" y="3455" width="161" height="54" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-168" value="Group / aggregate window&#xa;(optional)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1432" y="3443" width="252" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-169" value="Compute alert_intent_id&#xa;(deterministic)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1734" y="3443" width="237" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-170" value="Publish AlertIntentCreated&#xa;(alert_intent_id, event_ids, rule_id, payload)" style="strokeWidth=2;shape=process;whiteSpace=wrap;size=0.04;" vertex="1" parent="1">
          <mxGeometry x="2021" y="3427" width="231" height="111" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-171" value="Consume AlertIntentCreated" style="strokeWidth=2;shape=process;whiteSpace=wrap;size=0.04;" vertex="1" parent="1">
          <mxGeometry x="2624" y="3475" width="231" height="63" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-172" value="Idempotent upsert Alert&#xa;UNIQUE(alert_intent_id)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="2905" y="3504" width="235" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-173" value="Already SENT&#xa;or throttled?" style="rhombus;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="3362" y="3383" width="173" height="173" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-174" value="Apply throttle / rate limits&#xa;(per rule/subscription)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="3602" y="3430" width="253" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-175" value="Write Outbox message&#xa;status=PENDING&#xa;(attempt=0, next_retry_at=now)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="3905" y="3406" width="260" height="126" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-176" value="Publish OutboxEnqueued&#xa;(outbox_id, alert_intent_id)" style="strokeWidth=2;shape=process;whiteSpace=wrap;size=0.04;" vertex="1" parent="1">
          <mxGeometry x="4329" y="3439" width="231" height="87" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-177" value="Poll/Consume OutboxEnqueued&#xa;or query PENDING due items" style="strokeWidth=2;shape=process;whiteSpace=wrap;size=0.04;" vertex="1" parent="1">
          <mxGeometry x="4910" y="3427" width="231" height="111" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-178" value="Select delivery targets&#xa;(subscriptions/endpoints)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="5191" y="3443" width="243" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-179" value="Publish DeliveryRequested&#xa;(outbox_id, target, payload)" style="strokeWidth=2;shape=process;whiteSpace=wrap;size=0.04;" vertex="1" parent="1">
          <mxGeometry x="5667" y="3432" width="231" height="87" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-180" value="Consume DeliveryRequested" style="strokeWidth=2;shape=process;whiteSpace=wrap;size=0.04;" vertex="1" parent="1">
          <mxGeometry x="5998" y="3444" width="231" height="63" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-181" value="Send via provider adapter&#xa;(Telegram/Twitter/Webhook/etc.)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="6279" y="3437" width="307" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-182" value="Success?" style="rhombus;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="6636" y="3419" width="114" height="114" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-183" value="Publish DeliverySucceeded&#xa;(outbox_id, provider_msg_id)" style="strokeWidth=2;shape=process;whiteSpace=wrap;size=0.04;" vertex="1" parent="1">
          <mxGeometry x="6823" y="3501" width="231" height="87" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-184" value="Publish DeliveryFailed&#xa;(outbox_id, error, retryable?)" style="strokeWidth=2;shape=process;whiteSpace=wrap;size=0.04;" vertex="1" parent="1">
          <mxGeometry x="6823" y="3364" width="231" height="87" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-185" value="Consume DeliverySucceeded" style="strokeWidth=2;shape=process;whiteSpace=wrap;size=0.04;" vertex="1" parent="1">
          <mxGeometry x="7442" y="3989" width="231" height="63" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-186" value="Mark outbox=SENT&#xa;store provider_msg_id" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="7736" y="3898" width="219" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-187" value="Consume DeliveryFailed" style="strokeWidth=2;shape=process;whiteSpace=wrap;size=0.04;" vertex="1" parent="1">
          <mxGeometry x="7457" y="3755" width="202" height="39" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-188" value="Increment attempt_count" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="7723" y="3664" width="245" height="54" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-189" value="Retryable and attempts &amp;lt; max?" style="rhombus;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="8018" y="3552" width="278" height="278" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-190" value="Set next_retry_at&#xa;with backoff + jitter" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="8369" y="3424" width="206" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-191" value="Mark outbox=FAILED&#xa;(final)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="8371" y="3077" width="204" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-192" value="rules" style="shape=cylinder3;boundedLbl=1;backgroundOutline=1;size=10;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="1121" y="3186" width="50" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-193" value="subscriptions" style="shape=cylinder3;boundedLbl=1;backgroundOutline=1;size=10;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="5484" y="3219" width="108" height="74" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-194" value="alerts" style="shape=cylinder3;boundedLbl=1;backgroundOutline=1;size=10;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="3256" y="3185" width="56" height="62" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-195" value="outbox" style="shape=cylinder3;boundedLbl=1;backgroundOutline=1;size=10;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="4215" y="3091" width="64" height="64" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-196" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0.45;entryY=1;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-160" target="-gmcYHsltVzMwtbIWMZ_-165">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="544" y="3906" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-197" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.51;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-165" target="-gmcYHsltVzMwtbIWMZ_-166">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-198" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.51;entryX=0.38;entryY=1;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-166" target="-gmcYHsltVzMwtbIWMZ_-192">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1096" y="3482" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-199" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.99;exitY=0.5;entryX=0.43;entryY=0.01;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-192" target="-gmcYHsltVzMwtbIWMZ_-167">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1196" y="3216" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-200" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.51;entryX=0;entryY=0.51;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-167" target="-gmcYHsltVzMwtbIWMZ_-168">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-201" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.51;entryX=0;entryY=0.51;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-168" target="-gmcYHsltVzMwtbIWMZ_-169">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-202" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.51;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-169" target="-gmcYHsltVzMwtbIWMZ_-170">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-203" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-170" target="-gmcYHsltVzMwtbIWMZ_-161">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2277" y="3482" />
              <mxPoint x="2302" y="3906" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-204" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0.45;entryY=1;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-161" target="-gmcYHsltVzMwtbIWMZ_-171">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2599" y="3906" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-205" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.98;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-171" target="-gmcYHsltVzMwtbIWMZ_-172">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2880" y="3543" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-206" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0.35;entryY=1;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-172" target="-gmcYHsltVzMwtbIWMZ_-194">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3198" y="3543" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-207" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0.28;entryY=0;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-194" target="-gmcYHsltVzMwtbIWMZ_-173">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3337" y="3216" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-208" value="yes: drop" style="curved=1;startArrow=none;endArrow=block;exitX=0;exitY=0.5;entryX=1;entryY=0.01;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-173" target="-gmcYHsltVzMwtbIWMZ_-171">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2880" y="3469" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-209" value="no" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-173" target="-gmcYHsltVzMwtbIWMZ_-174">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-210" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-174" target="-gmcYHsltVzMwtbIWMZ_-175">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-211" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0.42;entryY=1;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-175" target="-gmcYHsltVzMwtbIWMZ_-195">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4190" y="3469" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-212" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.72;exitY=1;entryX=0.38;entryY=0;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-195" target="-gmcYHsltVzMwtbIWMZ_-176">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4304" y="3256" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-213" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-176" target="-gmcYHsltVzMwtbIWMZ_-162">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4585" y="3482" />
              <mxPoint x="4610" y="3906" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-214" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0.42;entryY=1;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-162" target="-gmcYHsltVzMwtbIWMZ_-177">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="4885" y="3906" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-215" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.51;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-177" target="-gmcYHsltVzMwtbIWMZ_-178">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-216" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.51;entryX=0.38;entryY=1;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-178" target="-gmcYHsltVzMwtbIWMZ_-193">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="5459" y="3482" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-217" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-193" target="-gmcYHsltVzMwtbIWMZ_-179">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="5617" y="3256" />
              <mxPoint x="5642" y="3476" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-218" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-179" target="-gmcYHsltVzMwtbIWMZ_-180">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-219" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-180" target="-gmcYHsltVzMwtbIWMZ_-181">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-220" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-181" target="-gmcYHsltVzMwtbIWMZ_-182">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-221" value="yes" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.86;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-182" target="-gmcYHsltVzMwtbIWMZ_-183">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="6787" y="3544" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-222" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-183" target="-gmcYHsltVzMwtbIWMZ_-163">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="7079" y="3544" />
              <mxPoint x="7104" y="4020" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-223" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-163" target="-gmcYHsltVzMwtbIWMZ_-185">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-224" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0.19;entryY=1;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-185" target="-gmcYHsltVzMwtbIWMZ_-186">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="7698" y="4020" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-225" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.47;exitY=0;entryX=0.98;entryY=1;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-186" target="-gmcYHsltVzMwtbIWMZ_-195">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="7698" y="3184" />
              <mxPoint x="4304" y="3184" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-226" value="no" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.13;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-182" target="-gmcYHsltVzMwtbIWMZ_-184">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="6787" y="3407" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-227" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-184" target="-gmcYHsltVzMwtbIWMZ_-164">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="7079" y="3407" />
              <mxPoint x="7104" y="3774" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-228" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.49;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-164" target="-gmcYHsltVzMwtbIWMZ_-187">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-229" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.49;entryX=0.31;entryY=1;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-187" target="-gmcYHsltVzMwtbIWMZ_-188">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="7698" y="3774" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-230" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-188" target="-gmcYHsltVzMwtbIWMZ_-189">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-231" value="yes" style="curved=1;startArrow=none;endArrow=block;exitX=0.89;exitY=1;entryX=0.44;entryY=1;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-189" target="-gmcYHsltVzMwtbIWMZ_-190">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="8333" y="3918" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-232" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.41;exitY=0;entryX=1.01;entryY=0.86;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-190" target="-gmcYHsltVzMwtbIWMZ_-195">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="8333" y="3164" />
              <mxPoint x="4304" y="3164" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-233" value="no" style="curved=1;startArrow=none;endArrow=block;exitX=0.71;exitY=0;entryX=0.32;entryY=1;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-189" target="-gmcYHsltVzMwtbIWMZ_-191">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="8333" y="3267" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-234" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0;exitY=0.26;entryX=1.01;entryY=0.21;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-191" target="-gmcYHsltVzMwtbIWMZ_-195">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="8333" y="3090" />
              <mxPoint x="4304" y="3090" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-253" value="Notification Channel" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="1353" y="-1051.5" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-255" value="" style="shape=flexArrow;endArrow=classic;html=1;rounded=0;endWidth=128;endSize=22.240000000000002;width=96;" edge="1" parent="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="807" y="-826" as="sourcePoint" />
            <mxPoint x="807" y="-602" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-480" value="WhaleWire System (.NET solution)" style="whiteSpace=wrap;strokeWidth=2;verticalAlign=top;fontSize=24;" vertex="1" parent="1">
          <mxGeometry x="233" y="-565" width="1913" height="1089" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-481" value="Workers (.NET)&#xa;(separate projects/modules)" style="whiteSpace=wrap;strokeWidth=2;verticalAlign=top;fontSize=24;" vertex="1" parent="1">
          <mxGeometry x="258" y="-260" width="1504" height="557" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-482" value="Data" style="whiteSpace=wrap;strokeWidth=2;verticalAlign=top;fontSize=24;" vertex="1" parent="1">
          <mxGeometry x="1812" y="-257" width="309" height="303" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-483" value="Event Bus / Topics" style="whiteSpace=wrap;strokeWidth=2;verticalAlign=top;fontSize=24;" vertex="1" parent="1">
          <mxGeometry x="907" y="-472" width="227" height="171" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-484" value="TON Provider&#xa;(3rd party)" style="whiteSpace=wrap;strokeWidth=2;verticalAlign=top;fontSize=24;" vertex="1" parent="1">
          <mxGeometry x="750" y="559" width="153" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-485" value="Notification Channels&#xa;(Telegram/Twitter/Webhook/...)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1441" y="559" width="296" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-486" value="Prometheus/Grafana&#xa;(optional, local)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1484" y="687" width="209" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-487" value="API (.NET)&#xa;Admin + Read APIs&#xa;(rules/labels/subscriptions, query events)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1457" y="337" width="263" height="126" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-488" value="RabbitMQ" style="shape=cylinder3;boundedLbl=1;backgroundOutline=1;size=10;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="978" y="-405" width="84" height="69" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-489" value="Postgres" style="shape=cylinder3;boundedLbl=1;backgroundOutline=1;size=10;strokeWidth=2;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="1929" y="-118" width="74" height="96" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-490" value="Trigger / Scheduler" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="283" y="102" width="198" height="54" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-491" value="Ingestor" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="556" y="-90" width="118" height="54" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-492" value="Normalizer" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="757" y="-80" width="139" height="54" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-493" value="Backfill Worker" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="531" y="196" width="169" height="54" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-494" value="Persistence Service&#xa;(EventStore + Checkpoints)" style="whiteSpace=wrap;strokeWidth=2;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="1487" y="-221" width="240" height="124" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-495" value="Checkpoint Updater" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1578" y="-172" width="139" height="54" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-496" value="Rule Engine" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1192" y="-79" width="143" height="54" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-497" value="Outbox Dispatcher" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1168" y="25" width="192" height="54" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-498" value="Notifier&#xa;(provider adapters)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1164" y="184" width="199" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-499" value="Telemetry&#xa;(/metrics + structured logs)" style="whiteSpace=wrap;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1837" y="256" width="259" height="78" as="geometry" />
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-500" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.59;exitY=0;entryX=0;entryY=0.49;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-490" target="-gmcYHsltVzMwtbIWMZ_-491">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="506" y="-63" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-501" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.6;exitY=0.99;entryX=0.44;entryY=0;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-491" target="-gmcYHsltVzMwtbIWMZ_-484">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="725" y="192" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-502" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.49;entryX=0;entryY=0.37;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-491" target="-gmcYHsltVzMwtbIWMZ_-492">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="725" y="-63" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-503" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.49;entryX=0.41;entryY=1;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-492" target="-gmcYHsltVzMwtbIWMZ_-488">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="953" y="-53" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-504" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0.43;entryY=0;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-493" target="-gmcYHsltVzMwtbIWMZ_-484">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="725" y="223" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-505" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.57;exitY=0;entryX=0;entryY=0.76;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-493" target="-gmcYHsltVzMwtbIWMZ_-492">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="725" y="-32" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-506" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.19;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-488" target="-gmcYHsltVzMwtbIWMZ_-494">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1087" y="-405" />
              <mxPoint x="1112" y="-173" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-507" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.18;entryX=0.04;entryY=0;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-494" target="-gmcYHsltVzMwtbIWMZ_-489">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1812" y="-203" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-509" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0;entryY=0.19;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-495" target="-gmcYHsltVzMwtbIWMZ_-489">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1812" y="-141" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-510" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.37;entryX=0;entryY=0.08;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-488" target="-gmcYHsltVzMwtbIWMZ_-496">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1087" y="-385" />
              <mxPoint x="1112" y="-100" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-511" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-496" target="-gmcYHsltVzMwtbIWMZ_-494">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
            <mxPoint x="1929" y="23.59415584415592" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-512" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0;exitY=0.86;entryX=1;entryY=0.55;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-496" target="-gmcYHsltVzMwtbIWMZ_-488">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1112" y="-10" />
              <mxPoint x="1087" y="-365" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-513" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.73;entryX=0;entryY=0;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-488" target="-gmcYHsltVzMwtbIWMZ_-497">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1087" y="-345" />
              <mxPoint x="1112" y="10" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-514" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-497" target="-gmcYHsltVzMwtbIWMZ_-494">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
            <mxPoint x="1929" y="48.581168831168725" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-515" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0;exitY=0.91;entryX=1;entryY=0.91;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-497" target="-gmcYHsltVzMwtbIWMZ_-488">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1112" y="88" />
              <mxPoint x="1087" y="-325" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-516" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.92;exitY=1;entryX=0;entryY=0.5;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-488" target="-gmcYHsltVzMwtbIWMZ_-498">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1087" y="-305" />
              <mxPoint x="1112" y="223" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-517" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.5;entryX=0.44;entryY=0;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-498" target="-gmcYHsltVzMwtbIWMZ_-485">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1416" y="223" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-518" value="" style="curved=1;startArrow=block;endArrow=none;rounded=0;endFill=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-494" target="-gmcYHsltVzMwtbIWMZ_-487">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1670" y="173" />
            </Array>
            <mxPoint x="1929" y="78.61363636363649" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-519" value="" style="curved=1;startArrow=none;endArrow=block;exitX=1;exitY=0.69;entryX=0;entryY=0.21;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-487" target="-gmcYHsltVzMwtbIWMZ_-499">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1762" y="432" />
              <mxPoint x="1787" y="268" />
              <mxPoint x="1812" y="268" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-520" value="" style="curved=1;startArrow=none;endArrow=block;exitX=0.62;exitY=0;entryX=0;entryY=0.42;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-486" target="-gmcYHsltVzMwtbIWMZ_-499">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1762" y="452" />
              <mxPoint x="1787" y="288" />
              <mxPoint x="1812" y="288" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="-gmcYHsltVzMwtbIWMZ_-521" value="" style="curved=1;startArrow=none;endArrow=block;rounded=0;" edge="1" parent="1" source="-gmcYHsltVzMwtbIWMZ_-481" target="-gmcYHsltVzMwtbIWMZ_-499">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="gFk5IqKCWkBaBIQ63dWb" name="Sequence">
    <mxGraphModel dx="788" dy="552" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="mLGP_i5QGSPSv08YkXKC" name="Event - Driven">
    <mxGraphModel dx="946" dy="662" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
